<div class="config-card">
    <h4 class="mb-4"><i class="fas fa-list-ul me-2"></i>白名单列表</h4>
    
    <div class="table-responsive">
        <table class="table table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th>模版ID</th>
                    <th>规则ID</th>
                    <th>规则名字</th>
                </tr>
            </thead>
            <tbody id="whiteListBody">
                <!-- 数据将动态加载到这里 -->
                <tr>
                    <td colspan="5" class="text-center text-muted py-4">
                        <div class="spinner-border spinner-border-sm" role="status">
                            <span class="visually-hidden">加载中...</span>
                        </div>
                        正在加载白名单数据
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <!-- 分页控制 -->
    <div class="d-flex justify-content-between align-items-center mt-3">
        <div>
            每页显示：
            <select id="pageSizeSelector" onchange="changePageSize(this.value)">
                <option value="5">5 条</option>
                <option value="10" selected>10 条</option>
                <option value="20">20 条</option>
            </select>
        </div>
        <div>
            <button class="btn btn-sm btn-outline-secondary me-2" onclick="prevPage()">上一页</button>
            <span id="pageInfo">第 1 页</span>
            <button class="btn btn-sm btn-outline-secondary ms-2" onclick="nextPage()">下一页</button>
        </div>
    </div>
    <div class="d-flex justify-content-end mt-3">
        <button class="btn btn-outline-primary" onclick="refreshList()">
            <i class="fas fa-sync-alt me-2"></i>刷新列表
        </button>
    </div>
</div>


<script src="../static/js/main.js"></script>
<script src="../static/js/deleteWhiteList.js"></script>

<script>
    let whiteListData = [];
    let currentPage = 1;
    let pageSize = 10;

    function changePageSize(size) {
        pageSize = parseInt(size);
        currentPage = 1;
        renderWhiteList();
    }

    function prevPage() {
        if (currentPage > 1) {
            currentPage--;
            renderWhiteList();
        }
    }

    function nextPage() {
        const totalPages = Math.ceil(whiteListData.length / pageSize);
        if (currentPage < totalPages) {
            currentPage++;
            renderWhiteList();
        }
    }

    function refreshList() {
        loadWhiteList();
    }

    function loadWhiteList() {
        const tbody = document.getElementById('whiteListBody');
        tbody.innerHTML = `
            <tr>
                <td colspan="5" class="text-center text-muted py-4">
                    <div class="spinner-border spinner-border-sm" role="status">
                        <span class="visually-hidden">加载中...</span>
                    </div>
                    正在加载白名单数据
                </td>
            </tr>`;

        fetch('/api/waf/listwhite')
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success' && Array.isArray(data.message)) {
                    whiteListData = data.message;
                    currentPage = 1;
                    renderWhiteList();
                } else {
                    tbody.innerHTML = `
                        <tr><td colspan="5" class="text-center text-muted py-4">没有找到白名单记录</td></tr>`;
                }
            })
            .catch(error => {
                console.error('加载失败:', error);
                tbody.innerHTML = `
                    <tr><td colspan="5" class="text-center text-danger py-4">数据加载失败</td></tr>`;
            });
    }

    function renderWhiteList() {
        const tbody = document.getElementById('whiteListBody');
        tbody.innerHTML = '';
        const startIndex = (currentPage - 1) * pageSize;
        const endIndex = startIndex + pageSize;
        const pageData = whiteListData.slice(startIndex, endIndex);

        if (pageData.length === 0) {
            tbody.innerHTML = `<tr><td colspan="5" class="text-center text-muted py-4">暂无数据</td></tr>`;
        } else {
            pageData.forEach(item => {
                const row = `
                    <tr>
                        <td>${item.rule_template}</td>
                        <td>${item.rule_id}</td>
                        <td>${item.rule_name}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteItem(${item.rule_id})">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    </tr>`;
                tbody.insertAdjacentHTML('beforeend', row);
            });
        }

        const totalPages = Math.ceil(whiteListData.length / pageSize);
        document.getElementById('pageInfo').textContent = `第 ${currentPage} 页 / 共 ${totalPages} 页`;
    }

    // 页面加载完就拉取数据
    document.addEventListener('DOMContentLoaded', function () {
        loadWhiteList();
    });
</script>